generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model LeadSignal {
  id          String   @id
  companyName String
  signalType  String
  description String
  source      String
  sourceUrl   String?
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([companyName])
  @@index([createdAt])
  @@index([signalType])
}

model Notification {
  id        String    @id
  userId    String
  signalId  String
  type      String
  status    String
  sentAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([status])
  @@index([userId])
}

model NotificationPreference {
  id           String   @id
  userId       String   @unique
  emailEnabled Boolean  @default(true)
  inAppEnabled Boolean  @default(true)
  frequency    String   @default("realtime")
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SignalSubscription {
  id         String   @id
  userId     String
  signalType String
  keywords   String[]
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([signalType])
  @@index([userId])
}

model User {
  id                     String                  @id
  clerkId                String                  @unique
  email                  String                  @unique
  name                   String?
  subscriptionTier       String                  @default("free")
  notificationsUsed      Int                     @default(0)
  notificationsLimit     Int                     @default(10)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  NotificationPreference NotificationPreference?
  SignalSubscription     SignalSubscription[]
  SavedSignal            SavedSignal[]
}

model SavedSignal {
  id          String   @id @default(cuid())
  userId      String
  signalId    String
  companyName String
  title       String?
  description String?
  metadata    Json?
  sourceUrl   String?
  notes       String?
  createdAt   DateTime @default(now())
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, signalId])
  @@index([userId])
  @@index([signalId])
}
